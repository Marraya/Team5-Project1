<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Map and Restaurant Happy Hour Database</title>
  <script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

  <style>
    #map {
      height: 400px;
      width: 100%;
    }
  </style>
</head>

<body>
  <h1>My Google Map</h1>
  <div id="map"></div>
  <p id="container"></p>
  <script>
    var markers = [
      {
        coords: { lat: 40.7549, lng: -73.9840 },
        iconImage: '',
        barName: "",
        barAddress: "",
        beerPrice: "",
        winePrice: "",
        mixDrink: "",
        foodPrice: "",

        // content:'<p id="container1">test</p>'
      },
      {
        coords: { lat: 40.7584, lng: -73.9957 },
        iconImage: '',
        barName: "",
        barAddress: "",
        beerPrice: "",
        winePrice: "",
        mixDrink: "",
        foodPrice: "",

        // content:'<p id="container1">test</p>'
      },

    ];
    function initMap() {
      // Map options
      var options = {
        zoom: 13,
        center: { lat: 40.7549, lng: -73.9840 }
      }
      // New map
      var map = new google.maps.Map(document.getElementById('map'), options);
      // Listen for click on map
      google.maps.event.addListener(map, 'click', function (event) {
        // Add marker
        addMarker({ coords: event.latLng });
      });
      /*
      // Add marker
      var marker = new google.maps.Marker({
        position:{lat:42.4668,lng:-70.9495},
        map:map,
        icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
      });
      var infoWindow = new google.maps.InfoWindow({
        content:'<h1>Lynn MA</h1>'
      });
      marker.addListener('click', function(){
        infoWindow.open(map, marker);
      });
      */
      // Array of markers

      // Loop through markers
      var config = {
        apiKey: "AIzaSyDc09T-OmJie6bBbWkx0FWsPT9Mk10ROp0",
        authDomain: "happy-hour-proje-1551302378847.firebaseapp.com",
        databaseURL: "https://happy-hour-proje-1551302378847.firebaseio.com",
        projectId: "happy-hour-proje-1551302378847",
        storageBucket: "happy-hour-proje-1551302378847.appspot.com",
        messagingSenderId: "650709499185"
      };
      firebase.initializeApp(config);
      // localStorage.setItem('logged-in-user', "SMViKPVcOHb2VP7YIMp9DWS1dSx1");
      //     var tblrestaurant = document.getElementById('tbl_restaurant_info');
      var databaseRef = firebase.database().ref('/restaurants/');
      var rowIndex = 1;
      // listening for event value change
      
      function displayMarkers(){
        for (var i = 0; i < markers.length; i++) {
              // Add marker
              console.log(markers)
              addMarker(markers[i]);
            }
      }
      databaseRef.once('value', function (snapshot) {
        snapshot.forEach(function (childSnapshot) {
          var childKey = childSnapshot.key;
          var childData = childSnapshot.val();

          if (childData.user_id === "-L_AF--wreUG4JwFyHBZ") {
            markers[0].iconImage = (childData.activeImage);
            markers[0].barName = (childData.bar_name);
            markers[0].barAddress = (childData.bar_location); 
            markers[0].barAddress = (childData.drinks_beer);
            markers[0].barAddress = (childData.bar_location);
            markers[0].barAddress = (childData.bar_location);
            markers[0].barAddress = (childData.bar_location);
            displayMarkers();
          }
          if (childData.user_id === "-L_AFq6YwV41N7p_Y18-") {
            markers[1].barName = (childData.bar_name);
            markers[1].barAddress = (childData.bar_location);
            displayMarkers();
          }


          
          // cellId.appendChild(document.createTextNode(childKey));
          // cellName1.appendChild(document.createTextNode(childData.bar_name));
          // cellName2.appendChild(document.createTextNode(childData.bar_location));
          // cellName3.appendChild(document.createTextNode(childData.closingTime));
          // cellName4.appendChild(document.createTextNode(childData.drinks_beer));
          // cellName5.appendChild(document.createTextNode(childData.drinks_wine));
          // cellName6.appendChild(document.createTextNode(childData.drinks_mix));
          // cellName7.appendChild(document.createTextNode(childData.food_wings));

          // rowIndex = rowIndex + 1;   


        });
      });
      // Add Marker Function

      function addMarker(props) {
        console.log("props", props);
        var marker = new google.maps.Marker({
          position: props.coords,
          map: map,

          //icon:props.iconImage
        });
        // Check for customicon
        if (props.iconImage) {
          // Set icon image
          marker.setIcon(props.iconImage);
        }
        // Check content

        if (props.barName) {
          console.log("props.barName", props.barName);
          var infoWindow = new google.maps.InfoWindow({
            content: props.barName + props.barAddress + props.beerPrice,

          });
          marker.addListener('click', function () {
            infoWindow.open(map, marker);
          });
        }
      }
    }


  </script>
  <!-- <script src="maker_and_database_combined.js"></script> -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzsfXudxbOJc1VXWKlJfSQelZB_Ywffyk&callback=initMap">

  </script>

</body>

</html>